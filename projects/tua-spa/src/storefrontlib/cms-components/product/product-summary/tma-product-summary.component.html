<ng-container *ngIf="page$ |async as page else loading">
  <ng-container *ngIf="product$ | async as product">
    <ng-container *ngIf="currency$ | async as currency">
      <ng-template
        [cxOutlet]="outlets.PRICE"
        [cxOutletContext]="{ product: product }"
      >

        <!-- Update consumption link -->
        <ng-container
          *ngIf="productService.isProductSpecificationForAverageCost(product?.productSpecification?.id)">
          <ng-container *ngIf="priceService.getUsageUnits(product).length <= 1; else costEstimationWarningMessage">
            <ng-container *ngIf="url$ | async as url">
              <ng-container *ngIf="getConsumptionComponent(page, product) as consumptionComponent">
                <div class="col-12 col-lg-7">
                  <div class="row font-small text-center d-flex justify-content-center">
                    {{ 'productList.averageCostBaseOnConsumption' | cxTranslate}}:
                  </div>
                  <div #consumptionValue class="row font-small cx-bold d-flex justify-content-center"
                       *ngFor="let formattedConsumption of getFormattedConsumptionList(consumptionComponent)">
                    {{formattedConsumption}}
                  </div>
                  <div class="row font-small d-flex justify-content-center">
                    <button class="btn btn-link"
                            (click)="updateConsumption(product, currency, consumptionComponent, url)">{{ 'productList.updateConsumption' | cxTranslate }}</button>
                  </div>
                </div>

                <br/>

                <div class="col-12 col-lg-7">
                  <div class="row d-flex justify-content-center">
                    <div #averageCostPerMonth
                         class="cx-size-large cx-bold">{{ getAverageCostPerMonth(product, currency, consumptionComponent) }}</div>
                    <div>&nbsp;/ {{ 'productDetails.month' | cxTranslate }}</div>
                  </div>
                  <div class="row cx-size-small d-flex justify-content-center">
                    (
                    <div #averageCostPerYear>
                      {{ getAverageCostPerYear(product, currency, consumptionComponent) }}
                    </div>
                    / {{ 'productDetails.year' | cxTranslate }}*)
                  </div>
                </div>
              </ng-container>
            </ng-container>
          </ng-container>
          <ng-template #costEstimationWarningMessage>
            <!-- Usage unit warning message -->
            <div class="text-warning cx-size-small">
              {{ 'productDetails.costEstimationWarningMessage' | cxTranslate }}
            </div>
            <br/>
          </ng-template>
        </ng-container>

        <ng-container
          *ngIf="!productService.isProductSpecificationForAverageCost(product?.productSpecification?.id) ||
              priceService.getUsageUnits(product).length > 1">
          <div *ngIf="this.priceService.getHighestPriorityPriceForSPO(product) as highestPriorityPrice">
            <cx-price-display [price]="highestPriorityPrice"></cx-price-display>
          </div>
        </ng-container>
      </ng-template>


      <ng-template
        [cxOutlet]="outlets.SUMMARY"
        [cxOutletContext]="{ product: product }"
      >
        <p [innerHTML]="product?.summary" class="summary"></p>
      </ng-template>
      <!-- @TODO: Temp. Comment out share link while not in use by CMS -->
      <!-- <ng-container *cxOutlet="outlets.SHARE">
              <div>
                <a href="#" class="share btn-link">
                  {{ 'productSummary.share' | cxTranslate }}
                </a>
              </div>
            </ng-container> -->
    </ng-container>
  </ng-container>
</ng-container>

<ng-template #loading>
  <div class="cx-spinner">
    <cx-spinner></cx-spinner>
  </div>
</ng-template>
